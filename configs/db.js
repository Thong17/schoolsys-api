const mongoose = require('mongoose')
const Role = require('../models/Role')

mongoose.connect(process.env.DATABASE_URL, {
    useNewUrlParser: true,
})
.then(async () => {
    const totalRole = await Role.count({ isDisabled: false })
    if (totalRole > 0) return

    const { preRole } = require('../constants/roleMap')
    let privilege
    Object.keys(preRole).forEach(menu => {
        privilege = {
            ...privilege,
            [menu]: {}
        }
        Object.keys(preRole[menu]).forEach(route => {
            privilege[menu][route] = true
        })
    })

    await Role.create({ name: { English: 'Super Admin' }, privilege, description: 'Default role generated by system' })
    console.log('Mongo Client is connected...')
})
.catch((error) => console.error(error))
